id: conversion_rate
display_name: Conversion Rate
domain: Marketing
category: Funnel
aliases: ["CR"]
description: Orders divided by sessions (site or app).
grain: day
dimensions:
  - { name: day, semantic: temporal }
  - { name: device, semantic: device }
  - { name: channel, semantic: marketing_channel }
  - { name: campaign, semantic: campaign }
  - { name: landing_page, semantic: content }
derived_from: []
business_rules: {}
formula:
  expression: "SAFE_DIVIDE(SUM(orders), NULLIF(SUM(sessions),0))"
  notes: "Make sure bots/internal traffic are filtered."
sql:
  bigquery:
    source_table: your_project.marketing.web_analytics_facts
    metric_view: your_project.analytics_mv.conversion_rate_daily
    params: ["@start_date", "@end_date"]
    query: |
      SELECT
        DATE(day) AS day,
        device, channel, campaign, landing_page,
        SAFE_DIVIDE(SUM(orders), NULLIF(SUM(sessions),0)) AS conversion_rate
      FROM `your_project.marketing.web_analytics_facts`
      WHERE day BETWEEN @start_date AND @end_date
      GROUP BY 1,2,3,4,5
tests:
  - name: bounds
    assertion: "conversion_rate BETWEEN 0 AND 1"
examples:
  business_questions:
    - "CR by device?"
    - "Landing pages with lowest CR?"
demo:
  seed_data: seeds/marketing/web_analytics_facts.sample.csv
