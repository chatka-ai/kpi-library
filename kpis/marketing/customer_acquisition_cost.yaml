id: customer_acquisition_cost
display_name: Customer Acquisition Cost (CAC)
domain: Marketing
category: Performance
aliases: ["cac", "acquisition cost"]
description: CAC = Total acquisition spend divided by number of new customers acquired.
grain: week
dimensions:
  - { name: week, semantic: temporal }
  - { name: channel, semantic: marketing_channel }
  - { name: campaign, semantic: campaign }
  - { name: region, semantic: geography }
derived_from: []
business_rules:
  spend_includes: ["media_spend","agency_fees"]
formula:
  expression: "SAFE_DIVIDE(SUM(acq_spend), NULLIF(SUM(new_customers), 0))"
  notes: "Define new_customers consistently (first purchase event)."
sql:
  bigquery:
    source_table: your_project.marketing.acquisition_facts
    metric_view: your_project.analytics_mv.cac_weekly
    params: ["@start_date", "@end_date"]
    query: |
      SELECT
        FORMAT_DATE('%G-W%V', date) AS week,
        channel, campaign, region,
        SAFE_DIVIDE(SUM(acq_spend), NULLIF(SUM(new_customers), 0)) AS cac
      FROM `your_project.marketing.acquisition_facts`
      WHERE date BETWEEN @start_date AND @end_date
      GROUP BY 1,2,3,4
tests:
  - name: positive_spend
    assertion: "acq_spend >= 0"
examples:
  business_questions:
    - "Which campaigns had CAC > target last month?"
    - "Did CAC improve in paid social after landing page changes?"
demo:
  seed_data: seeds/marketing/marketing_facts.sample.csv

